"use strict";(()=>{var e={};e.id=48,e.ids=[48],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},711:(e,r,a)=>{a.r(r),a.d(r,{patchFetch:()=>v,routeModule:()=>f,serverHooks:()=>k,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>p});var t={};a.r(t),a.d(t,{POST:()=>u});var n=a(2412),s=a(4293),o=a(4147),i=a(7856),l=a(9111),x=a(4292),d=a(9324),g=a(8927);let c=`Du \xe4r Recta ‚Äì en erfaren kollega som hj\xe4lper med rekryteringsbeslut genom naturlig konversation.

KRITISKA REGLER:
1. ST\xc4LL ALDRIG FLERA FR\xc5GOR SAMTIDIGT - endast EN fokuserad fr\xe5ga per svar
2. VARJE FR\xc5GA M\xc5STE VARA BESVARBAR P\xc5 1-2 MENINGAR - undvik komplexa flerdelade fr\xe5gor
3. N\xc4R F\xd6RTROENDE N\xc5R 85%+ - sluta st\xe4lla nya fr\xe5gor och fr\xe5ga om anv\xe4ndaren \xe4r redo f\xf6r n\xe4sta fas
4. V\xc4NTA P\xc5 ANV\xc4NDARENS BEKR\xc4FTELSE innan du g\xe5r vidare
5. ALDRIG inkludera fasnummer eller "FAS X:" i dina svar - bara ren konversation
6. BYGG F\xd6RST\xc5ELSE PROGRESSIVT - anv\xe4nd f\xf6reg\xe5ende svar f\xf6r att informera n\xe4sta fr\xe5ga

VIKTIGT: Om du st\xe4ller flera fr\xe5gor i samma meddelande bryter du mot reglerna. St\xe4ll ENDAST EN fr\xe5ga per svar.

EXEMPEL P\xc5 KORREKT BETEENDE:
‚ùå FEL: "Vad orsakar f\xf6rseningarna? Vad sa styrelsen?"
‚úÖ R\xc4TT: "Vad orsakar f\xf6rseningarna i era finansiella rapporter?"

‚ùå FEL: "Hur mycket f\xf6rsenade \xe4r rapporterna? Vilka konsekvenser har det?"
‚úÖ R\xc4TT: "Hur mycket f\xf6rsenade \xe4r era finansiella rapporter vanligtvis?"

FASER:
1. Problem & Pain Point üéØ - Identifiera det specifika problemet
2. Impact & Urgency ‚ö° - Kvantifiera p\xe5verkan och br\xe5dskan  
3. Success Criteria ‚úÖ - Definiera framg\xe5ngskriterier
4. Resources & Budget üí∞ - S\xe4kerst\xe4ll resurser och budget
5. Organization & Culture üè¢ - Validera organisationsberedskap
6. Alternatives & Risks üîÑ - Utv\xe4rdera alternativ och risker

STRATEGISK FR\xc5GEST\xc4LLNING (SPIN + Challenger):
- Fokusera p\xe5 KONFIDENTIELL information endast anv\xe4ndaren k\xe4nner till
- St\xe4ll fr\xe5gor om m\xe4nskliga dynamiker, politik, stakeholder-reaktioner
- F\xe5 konkreta detaljer: namn, datum, belopp, beteenden
- Undvik generiska aff\xe4rsfr\xe5gor som kan besvaras genom marknadsforskning
- Utmana antaganden med insikter och perspektiv
- V\xe4gled anv\xe4ndaren att uppt\xe4cka dolda problem

FR\xc5GEKVALITETSKRITERIER:
1. EN fr\xe5ga per meddelande - flera fr\xe5gor \xf6verv\xe4ldigar anv\xe4ndaren och minskar svarsfrekvensen
2. Fr\xe5gan m\xe5ste vara besvarbar p\xe5 1-2 meningar - undvik komplexa flerdelade fr\xe5gor
3. Fokusprogression - varje fr\xe5ga ska bygga naturligt p\xe5 f\xf6reg\xe5ende svar
4. Tydlig avsikt - anv\xe4ndaren ska f\xf6rst\xe5 varf\xf6r denna specifika fr\xe5ga \xe4r viktig f\xf6r rekryteringsanalysen

KONVERSATIONSTEMPO:
- St\xe4ll EN fokuserad fr\xe5ga
- V\xe4nta p\xe5 svar
- Anv\xe4nd svaret f\xf6r att informera n\xe4sta strategiska fr\xe5ga
- Bygg f\xf6rst\xe5else progressivt ist\xe4llet f\xf6r informationsdumpning

EXEMPEL P\xc5 STRATEGISKA FR\xc5GOR:
‚ùå D\xe5ligt: "Hur p\xe5verkar det er s\xe4ljorganisation?"
‚úÖ Bra: "Vilka av era s\xe4ljare har redan b\xf6rjat fr\xe5ga om nya jobb?"

‚ùå D\xe5ligt: "Vad h\xe4nder med skalbarhet?"
‚úÖ Bra: "Vilka specifika kunder har uttryckt oro \xf6ver er s\xe4ljledning?"

‚ùå D\xe5ligt: "Hur p\xe5verkar detta er tekniska skuld?"
‚úÖ Bra: "Vad sa styrelsen n\xe4r de fick h\xf6ra om situationen?"

EXEMPEL P\xc5 FR\xc5GEKVALITET:
‚ùå D\xe5ligt: "Vad ser ni som den st\xf6rsta utmaningen med att er nuvarande s\xe4ljchef l\xe4mnar? Hur p\xe5verkar det er s\xe4ljorganisation? Vad h\xe4nder med er skalbarhet?"
‚úÖ Bra: "Vad ser ni som den st\xf6rsta utmaningen med att er nuvarande s\xe4ljchef l\xe4mnar?"

‚ùå D\xe5ligt: "Ber\xe4tta om era finansiella utmaningar, hur p\xe5verkar det er rapportering, och vilka compliance-risker finns?"
‚úÖ Bra: "Vilka specifika finansiella utmaningar har ni just nu?"

KONVERSATIONSSTIL:
- Prata naturligt och direkt, som en erfaren kollega
- Anv\xe4nd korta, konkreta fr\xe5gor som fokuserar p\xe5 intern information
- Undvik formella \xf6verg\xe5ngar och sammanfattningar
- Bekr\xe4fta kort och g\xe5 vidare med strategiska f\xf6ljdfr\xe5gor
- St\xe4ll f\xf6ljdfr\xe5gor f\xf6r att f\xf6rst\xe5 helheten
- H\xe5ll stycken korta och naturliga
- EN ENDA fokuserad fr\xe5ga per svar
- Varje fr\xe5ga ska vara besvarbar p\xe5 1-2 meningar
- Bygg f\xf6rst\xe5else progressivt, inte informationsdumpning

EXEMPEL P\xc5 NATURLIG KONVERSATION:
‚ùå Undvik: "L\xe5t mig sammanfatta f\xf6r att s\xe4kerst\xe4lla att jag f\xf6rst\xe5tt korrekt. Baserat p\xe5 er information verkar ni ha utmaningar med..."
‚úÖ Anv\xe4nd: "Okej, s\xe5 ni beh\xf6ver n\xe5gon med enterprise-erfarenhet. Vad kostar det er att sakna denna person?"

‚ùå Undvik: "Kan du kvantifiera den ekonomiska p\xe5verkan av detta problem?"
‚úÖ Anv\xe4nd: "Vad kostar det er?"

‚ùå Undvik: "F\xf6r att b\xe4ttre f\xf6rst\xe5 situationen, skulle du kunna beskriva..."
‚úÖ Anv\xe4nd: "Ber\xe4tta mer om..."

FAS\xd6VERG\xc5NG:
Du kommer att f\xe5 information om n\xe4r anv\xe4ndaren har tillr\xe4ckligt med information f\xf6r att g\xe5 vidare.
N\xe4r du f\xe5r "PHASE_STATUS: READY_FOR_PROGRESSION" - f\xf6resl\xe5 att g\xe5 vidare till n\xe4sta fas ist\xe4llet f\xf6r att st\xe4lla fler fr\xe5gor.

N\xe4r fasen \xe4r redo f\xf6r progression, s\xe4g:
"Vi har nu samlat tillr\xe4cklig information om [fasnamn]. \xc4r du redo att g\xe5 vidare till n\xe4sta fas d\xe4r vi kommer att utforska [n\xe4sta fas]?"

STOPPA H\xc4R - st\xe4ll inga fler fr\xe5gor efter detta meddelande. V\xe4nta p\xe5 anv\xe4ndarens val.`;async function u(e){try{console.log("\uD83D\uDD0D API - Starting /api/arena/chat request");let r=await e.json();try{console.log("\uD83D\uDD0D API - Request body (keys):",r?Object.keys(r):null),console.log("\uD83D\uDD0D API - Messages length:",Array.isArray(r?.messages)?r.messages.length:null),console.log("\uD83D\uDD0D API - currentCluster:",r?.currentCluster),console.log("\uD83D\uDD0D API - canProgressToNext:",r?.canProgressToNext)}catch{}if(!r||!Array.isArray(r.messages)||0===r.messages.length)return console.log("\uD83D\uDD0D API - Error: Invalid request body"),i.NextResponse.json({message:"",error:"Invalid request: messages required"},{status:400});let a=r.messages.filter(e=>e&&("user"===e.role||"assistant"===e.role)&&"string"==typeof e.content).map(e=>({role:e.role,content:(e.content||"").toString()}));if(0===a.length)return console.log("\uD83D\uDD0D API - Error: No valid messages after sanitization"),i.NextResponse.json({message:"",error:"Invalid messages format"},{status:400});let t=a[a.length-1];if(!t||"user"!==t.role||!t.content?.trim())return console.log("\uD83D\uDD0D API - Error: Last message invalid"),i.NextResponse.json({message:"",error:"Last message must be from user with content"},{status:400});console.log("\uD83D\uDD0D API - Calling chatWithClaude...");let n=(0,x.R3)(a);console.log("\uD83D\uDD0D API - Role context detected:",n);let s=c;"default"!==n.role&&(s+=`

ROLLSPECIFIK KONTEXT:
Du hj\xe4lper med rekrytering av en ${n.role.toUpperCase()} (${n.seniority} niv\xe5).
Fokusera p\xe5 ${n.department}-specifika utmaningar och anv\xe4nd relevant terminologi.
St\xe4ll fr\xe5gor som \xe4r relevanta f\xf6r denna rolltyp.`);try{let e=JSON.stringify(r).length;console.log("\uD83D\uDD0D API - Approx payload bytes:",e)}catch{}if(r.canProgressToNext&&r.currentCluster){let e={"pain-point":"Problem & Pain Point","impact-urgency":"Impact & Urgency","success-criteria":"Success Criteria","resources-budget":"Resources & Budget","organization-culture":"Organization & Culture","alternatives-risks":"Alternatives & Risks"}[r.currentCluster]||r.currentCluster,a={"pain-point":"Impact & Urgency","impact-urgency":"Success Criteria","success-criteria":"Resources & Budget","resources-budget":"Organization & Culture","organization-culture":"Alternatives & Risks","alternatives-risks":"slutrapporten"}[r.currentCluster]||"n\xe4sta fas",t=`

PHASE_STATUS: READY_FOR_PROGRESSION (Current: ${e} -> Next: ${a}; confidence=${r.clusterProgress?.confidence||0}%)`;s+=t,console.log("\uD83D\uDD0D API - Added phase completion status to system prompt")}let o=a.slice(-10);console.log("\uD83D\uDD0D API - Using recent messages:",o.length);let u=o.map(e=>({role:e.role,content:e.content,timestamp:new Date().toISOString()})),f="";try{if(f=(await (0,l.m)(u,s)).text,"default"!==n.role&&r.currentCluster&&!r.canProgressToNext){if(.3>Math.random()){let e=(0,x.AO)(n,r.currentCluster,a);console.log("\uD83D\uDD0D API - Challenger insight generated:",e),(f.length<100||!f.includes(n.department))&&(f=`${f}

${e}`)}else{let e=(0,x.kC)(r.currentCluster,n,[]);console.log("\uD83D\uDD0D API - Strategic question generated:",e),(f.length<100||!f.includes(n.department))&&(f=`${f}

${e}`)}if((f.match(/\?/g)||[]).length>1){console.log("\uD83D\uDD0D API - Multiple questions detected, keeping only the first one");let e=f.indexOf("?")+1;f=f.substring(0,e)}}}catch(e){return console.error("‚ùå API - Claude call failed:",e?.message),i.NextResponse.json({message:"",error:e?.message||"Claude failed"},{status:502})}console.log("\uD83D\uDD0D API - Claude response length:",f?.length||0);let m=[];"default"!==n.role&&r.currentCluster&&(m=await (0,x.JO)(n,r.currentCluster,f,a),console.log("\uD83D\uDD0D API - Quick response suggestions generated:",m));let p=r.currentCluster||"pain-point",k=t.content,v=Math.max(0,Math.round(r.clusterProgress?.confidence||0));console.log("\uD83D\uDD0D API - CUMULATIVE: prevConfidence =",v);let A=(0,x.qi)(k,p,n),E=(0,g.Zy)(k,k.toLowerCase()),h=Math.max(1,E.categoriesCovered),I=Math.round(Math.min(15,A.confidence/3+1.5*h));console.log("\uD83D\uDD0D API - CUMULATIVE: msgAnalysis.confidence =",A.confidence),console.log("\uD83D\uDD0D API - CUMULATIVE: qa.categoriesCovered =",E.categoriesCovered),console.log("\uD83D\uDD0D API - CUMULATIVE: incremental added =",I);let R=d.L$[n.seniority]?.[n.department]??80,P=v+I;P<v&&(P=v),P=Math.min(P,R),console.log("\uD83D\uDD0D API - CUMULATIVE: roleCap =",R),console.log("\uD83D\uDD0D API - CUMULATIVE: final cumulativeConfidence =",P);let S=!!r.clusterProgress&&(0,x.K8)(r.clusterProgress,p),y={message:f??"",roleContext:{role:n.role,seniority:n.seniority,department:n.department},analysis:{confidence:P,quality:A.quality,categoriesCovered:E.categoriesCovered,missingInsights:A.missingInfo},quickResponses:m,canProgressToNext:!!S};return console.log("\uD83D\uDD0D API - Structured response payload:",y),i.NextResponse.json(y,{status:200})}catch(e){return console.error("\uD83D\uDD0D API - Error details:",e),console.error("\uD83D\uDD0D API - Error stack:",e instanceof Error?e.stack:"No stack trace"),i.NextResponse.json({message:"",error:e instanceof Error?e.message:"Internal server error"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/arena/chat/route",pathname:"/api/arena/chat",filename:"route",bundlePath:"app/api/arena/chat/route"},resolvedPagePath:"/Users/christoffersundberg/recta-v2/app/api/arena/chat/route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:m,workUnitAsyncStorage:p,serverHooks:k}=f;function v(){return(0,o.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:p})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[267,520,741],()=>a(711));module.exports=t})();